<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

  
<mapper namespace="VideoBBS">
	<insert id="videoBbsWrite" parameterType="kh.com.a.model.VideoBBSDto">
	INSERT INTO VIDEOBBS(ID, TITLE, CONTENT, VIDEO, THUMBNAIL, GENRE, WDATE, READCOUNT, VIDEO_SEQ)
	VALUES(#{id}, #{title}, #{content}, #{video}, #{thumbnail}, #{genre}, SYSDATE, 0, VIDEO_SEQ.NEXTVAL)
	</insert>
	
	<select id="getVideoBbsList" resultType="kh.com.a.model.VideoBBSDto">
	SELECT  ID, TITLE, CONTENT, VIDEO, THUMBNAIL, WDATE, READCOUNT, VIDEO_SEQ, GENRE 
	FROM VIDEOBBS
	</select>
	
	<select id="getVideoBbs" resultType="kh.com.a.model.VideoBBSDto">
	SELECT ID, TITLE, CONTENT, VIDEO, THUMBNAIL, WDATE, READCOUNT, VIDEO_SEQ, GENRE
	FROM VIDEOBBS
	WHERE VIDEO_SEQ=#{video_seq}
	</select>

	
	<update id="videoBbsUpdate" parameterType="kh.com.a.model.VideoBBSDto">
	UPDATE VIDEOBBS
	SET TITLE=#{title}, CONTENT=#{content}, WDATE=SYSDATE
	WHERE VIDEO_SEQ=#{video_seq}
	</update>
	
	<delete id="videoBbsDelete" parameterType="java.lang.Integer">
		DELETE
		FROM VIDEOBBS
		WHERE VIDEO_SEQ=#{video_seq}
	</delete>


	<select id="getVideoRank" resultType="kh.com.a.model.VideoBBSDto">
							
		SELECT VB.ID, VB.TITLE, VB.CONTENT, VB.VIDEO, VB.WDATE, 
		VB.THUMBNAIL, VB.GENRE, VB.READCOUNT, VB.VIDEO_SEQ FROM VIDEOBBS VB,
					(SELECT VIDEO_SEQ, COUNT(MEMID) TOTAL FROM VIDEO_LIKE 
					GROUP BY VIDEO_SEQ ORDER BY COUNT(MEMID)) VL 
					WHERE VB.VIDEO_SEQ = VL.VIDEO_SEQ ORDER BY TOTAL DESC
							
	</select>
	
	<select id="checkfollow" parameterType="java.util.HashMap" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM FOLLOW WHERE MEMID = #{follower} AND MUSEID = #{following}
		<!-- SELECT NVL2(FOLLOW_SEQ, FOLLOW_SEQ, 0) FROM FOLLOW WHERE MEMID = #{follower} AND MUSEID = #{following} -->
		<!-- NVL2(FOLLOW_SEQ, FOLLOW_SEQ, 0) -->
	</select>
	
	<select id="checkSeq" parameterType="java.util.HashMap" resultType="java.lang.Integer">
		SELECT FOLLOW_SEQ FROM FOLLOW WHERE MEMID = #{follower} AND MUSEID = #{following}
	</select>
	<delete id="cancelFollow" parameterType="java.lang.Integer">
		DELETE FROM FOLLOW WHERE FOLLOW_SEQ = #{seq}
	</delete>
	
	<insert id="dofollow" parameterType="java.util.HashMap">
		INSERT INTO FOLLOW VALUES(FOLLOW_SEQ.NEXTVAL, #{follower}, #{following})
	</insert>
	
	
</mapper>